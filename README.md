# 아이템 시뮬레이터
Node.Js, Express.js등을 활용하여 만든 아이템 시뮬리이터 입니다. 프론트 제공 X

# 요구 사항
1. 회원가입 API
    - 아이디, 비밀번호, 비밀번호 확인, 이름을 데이터로 넘겨서 회원가입을 요청합니다.
        - 보안을 위해 비밀번호는 평문(Plain Text)으로 저장하지 않고 해싱된 값을 저장합니다.
    - 아래 사항에 대한 **유효성 체크**를 해야 되며 유효하지 않은 경우 알맞은 HTTP 상태코드와 에러 메세지를 반환해야 합니다.
        - **아이디**: 다른 사용자와 중복될 수 없으며 오로지 **영어 소문자 + 숫자 조합**으로 구성이 되어야 합니다.
        - **비밀번호:** 최소 6자 이상이며, 비밀번호 확인과 일치해야 합니다.
    - 회원가입 성공 시, 비밀번호를 제외 한 사용자의 정보를 반환합니다.
      
2. 로그인 API
    - 아이디, 비밀번호로 로그인을 요청합니다.
    - 계정 정보가 일치하지 않을 경우 알맞은 HTTP 상태코드와 에러 메세지를 반환해야 합니다.
        - 아이디가 존재하지 않는 경우
        - 아이디는 존재하는데 비밀번호가 틀리는 경우
    - **로그인 성공 시, 엑세스 토큰을 생성하여 반환합니다.**
        - 이 때, 엑세스 토큰의 Payload는 로그인 한 계정의 ID를 담고 있어야겠죠?
          
3. 캐릭터 생성 API **→ (JWT 인증 필요)**
    - 캐릭터 명을 **request**에서 전달하기 & 캐릭터 ID를 **response**로 돌려받기
        - 이 때, 이미 존재하는 캐릭터 명으로 캐릭터 생성을 하려고 하면 생성을 못하게 해주세요!
        - 사실은 캐릭터 명 말고도 캐릭터에 대한 여러가지 정보를 서버에 보내야하지만 여기선 간소화합니다!
    - 캐릭터에는 다음과 같은 스탯이 있습니다.
        - **health: 500**
        - **power: 100**
        - 여건이 된다면 다른 스탯들도 정의해주셔도 무관합니다.
    - 또한, **캐릭터 생성을 할 때마다 캐릭터에 기본 게임 머니를 1만원을 제공합니다.**
        - **money: 10000**
        - 해당 게임 머니로 아이템을 살 수 있으며 각각의 캐릭터는 고유 게임 머니가 있습니다.
          
4. 캐릭터 삭제 API **→** **(JWT 인증 필요)**
    - 삭제할 캐릭터의 ID는 URI의 **parameter**로 전달하기
        - 예시: `DELETE /api/characters/**321**` ← 321번 캐릭터 삭제! 굵은 글씨가 parameter에요!
    - 내 계정에 있는 캐릭터가 아니라면 삭제시키면 안되겠죠?
      
5. 캐릭터 상세 조회 API
    - 조회할 캐릭터의 ID는 URI의 **parameter**로 전달하기
    - 캐릭터 이름, HP, 힘 스탯을 전달해주세요!
        - 다만, **내 캐릭터를 상세 조회시에는 현재 캐릭터가 갖고있는 게임 머니까지 조회**가 되어야 합니다.
  
6. 아이템 생성 API
    - 아이템 코드, 아이템 명, 아이템 능력 및 **아이템 가격**을 **request**에서 전달 받기
        - 이 때, 아이템 능력은 JSON 포맷으로 전달해주시면 됩니다.
            
7. 아이템 수정 API
    - 아이템 코드는 URI의 **parameter**로 전달 받기
    - 아이템 명, 아이템 능력을 **request**에서 전달 받기
        - 아이템 생성과 마찬가지로 전달을 해주시면 됩니다.
    - **단, 아이템 가격은 수정할 수 없게 해주세요!**
    - 
8. 아이템 목록 조회 API
    - 아이템 코드, 아이템 명, 아이템 가격 내용만 조회
    - 아이템 생성 API를 통해 생성된 모든 아이템들이 목록으로 조회가 될 수 있어야 합니다.
        
9. 아이템 상세 조회 API
    - 아이템 코드를 URI의 **parameter**로 전달 받아 아이템 코드, 아이템 명, 아이템 능력, 아이템 가격을 조회

# 도전 요구 사항
### **1. 아이템 구입 API  → (JWT 인증 필요)**

- 아이템 구입은 무한하게 할 수 없으며 우리가 가진 게임 머니 안에서 아이템을 구입할 수 있습니다.
- 아이템 구입 이후 아이템의 가격 만큼 게임 머니가 차감 됩니다.
- 구입할 내 캐릭터의 ID를 URI의 parameter로 전달받고 구입하고 싶은 아이템의 코드와 수량을 request에서 전달을 받도록 할게요.
- 사고싶은 총 아이템의 가격이 게임 머니보다 크면 구입을 거절합니다.
    - 또한, 존재하지 않는 item_code가 있어도 유효하지 않은 아이템 구입이라고 거절을 당해야 합니다.
    - **가격은 request의 body로 받지 않습니다.**
- 구입 성공 시 response로는 변경된 게임 머니 잔액을 리턴해주도록 합시다!
- 또한, 구입에 성공을 하게 되면 **이 아이템들은 곧바로 장착되는 것이 아니라 인벤토리로 가야합니다.**

### **2. 아이템 판매 API  → (JWT 인증 필요)**

- 게임 아이템들은 팔게 되면 **원가의 60% 가격으로 정산**을 받아야하고 판매 성공 시 response로는 변경된 게임 머니 잔액을 리턴해주도록 합시다!
- 아이템 판매 시에는 **인벤토리에 있는 아이템만 팔 수 있도록 하며** 장착중인 아이템은 팔 수 없습니다.

### **3. 캐릭터가 보유한 인벤토리 내 아이템 목록 조회 API  → (JWT 인증 필요)**

- 인벤토리 목록을 조회할 내 캐릭터의 ID를 URI의 **parameter**로 전달 받기
  
### **4. 캐릭터가 장착한 아이템 목록 조회 API**

- 장착된 아이템 목록을 조회할 아무 캐릭터의 ID를 URI의 **parameter**로 전달 받기
    - 기본적으로는 아무런 장착을 하지 않았다면 빈 배열로 던져질 것입니다.
    - 게임 내에서 유저가 장착한 아이템을 보는 것은 다른 게임에서도 자유롭게 할 수 있으니 이 API는 인증 미들웨어를 거치지 않아도 됩니다.
    
### **5. 아이템 장착 API  → (JWT 인증 필요)**

- 아이템을 장착할 내 캐릭터의 ID를 URI의 **parameter**로 전달 받기
- 장착할 아이템 코드를 **request**에서 전달 받기
    - 현재 캐릭터 인벤토리에 존재하지 않는 아이템이 아니라면 없는 아이템이라고 장착이 거부되어야 합니다!
    - 이 때, 이미 장착한 아이템(아이템 코드 기반으로 구분할 수 있겠죠)을 또 장착하려고 하면 이미 장착된 아이템이라고 장착이 거부되어야 합니다!
        - 아이템 코드가 같은 아이템이 다수 인벤토리에 있어도 장착은 1개만 할 수 있다는 얘기!
- **매우 중요: 아이템 장착을 하게 되면 캐릭터의 스탯이 올라가야 합니다!**
    - 아이템 장착에 성공하면 기존 캐릭터의 스탯을 직접적으로 변경해주도록 해요.
    - 예시
        - BEFORE.
            - 캐릭터 스탯: { health: 500, power: 100 }
        - “파멸의 반지”를 장착!
        - AFTER.
            - 캐릭터 스탯: { health: **520**, power: **102** }
    - 캐릭터 조회 API를 사용할 때 변경된 캐릭터 스탯으로 출력
- 그리고, 캐릭터-인벤토리 테이블에서 해당 아이템 정보는 변경 혹은 삭제가 되도록 구현.
    - 인벤토리에 1개밖에 없던 아이템을 장착시에는 아이템 정보를 삭제
    - n(n ≥ 2)개 이상 있던 아이템을 장착시에는 아이템 개수를 n-1 개로 변경

### **6. 아이템 탈착 API  → (JWT 인증 필요)**

- 아이템을 장착할 내 캐릭터의 ID를 URI의 **parameter**로 전달 받기
- 탈착할 아이템 코드를 **request**에서 전달 받기
    - 이 때, 장착 되지 않은 아이템을 탈착하려고 하면 장착 되어있지 않은 아이템이라고 탈착이 거부되어야 합니다!
- **매우 중요: 아이템 탈착을 하게 되면 캐릭터의 스탯이 떨어져야 합니다!**
    - 아이템 탈착에 성공하면 기존 캐릭터의 스탯을 직접적으로 변경해주도록 해요.
- 또한, 캐릭터-아이템 테이블에서 해당 아이템 정보를 삭제해야 됩니다.
- 그리고, 캐릭터-인벤토리 테이블에서 해당 아이템 정보는 변경 혹은 추가가 되어야겠죠.
    - 인벤토리에 존재하지 않은 아이템을 탈착시에는 아이템 정보를 추가
    - n(n ≥ 1)개 이상 있던 아이템을 탈착시에는 아이템 개수를 n+1 개로 변경
    

### **7. 게임 머니를 버는 API → (JWT 인증 필요)**

- 캐릭터마다 초기에 게임 머니 1만원을 지급하는데 이걸론 뭔가 좀 아쉽습니다.
- 아이템을 더 구입하고 싶다면 게임 머니를 버는 해당 API를 불러서 100원씩 벌게끔 해봅시다!
- 돈을 벌 내 캐릭터의 ID를 URI의 **parameter**로 전달 받기만 하면 해당 캐릭터의 잔액 게임 머니를 100원씩 늘려주고 response로 변경된 잔액 게임 머니를 전달해주세요. 

# 사용 기술
1. 베이스 : Node.js

2. 웹 프레임워크 : Express.js

3. 패키지 매니저 : yarn

4. 모듈 시스템 : ES6 모듈 시스템

5. 데이터베이스 : RDS

6. 배포 : AWS EC2 / PM2

# 파일 구조
![image](https://github.com/user-attachments/assets/eb9ec30c-6192-4a55-8d9f-1f212f079068)

# API 명세서

| <div style="width: 200px">기능</div>                      | API URL                              | Method | Request                                                             | Response                                                                                      |
|----------------------------|--------------------------------------|--------|--------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| 사용자 회원가입               | `/api/sign-up`                    | POST   | ` {"username": "1","password": "password1234","confirmPassword": "password1234","name":"테스트사용자"} `                                           | ` {"message": "회원가입이 완료되었습니다.","user": {"id": 1,"username": "1","name": "테스트사용자"} }`
| 로그인                    | `/api/sign-in`                    | POST   | ` {"username": "Ebar","password": "qwer1234"} `                                           | ` {"message": "로그인 성공"} `
| 캐릭터 생성                | `/api/Character`                    | POST   | ` {"name":"TESTER"} `                                           | `{ "message": "캐릭터 생성 성공","characterId": 1} `                                                                       |
| 캐릭터 삭제                | `/api/character/:Id`       | DELETE | `{ }`                                                              | `{ "message": "캐릭터가 삭제되었습니다." }`                                                                                        |
| 캐릭터 조회                | `/api/Character/:Id`       | GET    | `{ }`                                                              | `{"name": "TESTER","health": 500,"power": 100,"money": 10000}`                                        |
| 아이템 생성                | `/api/items`                         | POST   | `{"item_code": 1,"item_name": "부채","item_stat": { "health": 20, "power": 2 },"item_price": 500 }` | `{"message": "새로운 아이템 생성","newItem": {"id": 1,"item_code": 1,"item_name": "부채", "item_stat": { "power": 2, "health": 20 }, "item_price": 50 } } }`          |
| 아이템 수정                | `/api/items/:item_code`               | PUT  | `{"item_name": "물통", "item_stat": { "health": 40 }}`              | `{"id": 1,"item_code": 1,"item_name": "물통","item_stat": { "health": 40 },"item_price": 500 }`                                                                                        |
| 아이템 조회            | `/api/item`                         | GET    | `{ }`                                                              | ` [ {"item_code": 1,"item_name": "물통","item_price": 500}` |
| 특정 아이템 조회            | `/api/item/:item_code/detail`               | GET    | `{ }`                                                              | `{ "item_code": 1,"item_name": "물통","item_stat": {	"health": 40},"item_price": 500 }`     |
| 아이템 구매            | `/api/items/:character_id/purchase`               | POST    | `[{"item_code": 1,"count": 1}]`                                 | `{ "message": "아이템 구매 성공","remainingMoney": 9500 }`     |
| 아이템 판매            | `/api/items/:character_id/sell`               | POST    | `[{"item_code": 1,"count": 1}]`                                     | `{ "message": "아이템 구매 성공","remainingMoney": 10000 }`     |
| 아이템 장착            | `/api/item/:character_id/equip`               | POST    | `[{"item_code": 1}]`                                     | `{ "message": "아이템 장착 성공." }`   |
| 캐릭터가 장착중인 아이템 조회 | `/api/characters/:character_id/items` | GET    | `{ }`                                                              | `[{"item_code": 1,"item_name": "물통"}]                                                     |
| 캐릭터에서 아이템 해제      | `/api/characters/:character_id/detach` | DELETE | `{ "item_code": 1 }`                                               | `{"message": "아이템 탈착 성공","updated_character": {"id": 1,"name": "TESTIER","health": 500,"power": 100,"money": 10000,"userId": 1}}`                                                                  |
| 보유 게임 머니 증가      | `/api/characters/:character_id/earn-money` | DELETE | `{ }`                                               | `{"message": "게임 머니 증가 성공","current_money": 10100}`                                          |

# 링크
> 배포 링크
http://3.35.171.94:3018



